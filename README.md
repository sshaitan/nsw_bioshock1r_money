# BioShock Remastered (Nintendo Switch) Money Save Editor

Небольшой скрипт на Python для правки количества денег в сохранениях
**BioShock (1) Remastered** на **Nintendo Switch**.

![Proof of concept](https://i.imgur.com/BUKLzrS.png "Screenshot")

> ⚠️ Используйте на свой страх и риск. Всегда делайте бэкап сейвов.

## Что делает скрипт

* Читает файл `mainSave.bsg` из версии игры для Nintendo Switch.
* Разбирает внутреннюю структуру сохранения:
  * заголовок (0x44 байта),
  * последовательность zlib-блоков с проставленными между ними размерами.
* Находит в распакованных данных сигнатуру блока игрока, где хранится
  текущий баланс денег, и меняет это значение на указанное.
* Перепаковывает изменённый блок обратно в zlib, обновляет размер блока
  в заголовке и собирает новое сохранение.

Скрипт **не трогает** остальную структуру файла.

## Особенность игры: лимит 500$

BioShock Remastered имеет внутренний игровой лимит кошелька — **максимум 500$**.

Это значит:

* Вы можете задать в сейве любое большое количество денег (5000, 20000 и т.д.).
* Игра позволит вам **закупиться на эти деньги полностью**.
* Но **при первом же подборе денег в мире игры** движок автоматически выставит баланс обратно в **500$**.

Это **не ошибка скрипта**, а внутренняя механика геймплея.

Таким образом, практичный сценарий таков:

1. Заливаете в сейв, например, **5000$**.
2. Загружаете игру и идёте к торговым автоматам.
3. Затариваетесь чем нужно по полной.
4. Игра сама установит 500$, но вы уже закупились заранее.

## Требования

* Python **3.8+** (проверено на Linux с Python 3.12). Под Windows тоже должно работать, просто поставьте python3 версии 3.8 или выше [https://www.python.org/downloads/windows/](https://www.python.org/downloads/windows/)
* Никаких внешних библиотек (зависимостей) не требуется — используются только стандартные модули:
  `struct`, `zlib`, `pathlib`, `sys`.

## Как получить сейв

На взломанном Switch можно использовать, например, **DBI**:

1. Подключить консоль по USB.
2. В DBI запустить MTP-responder.
3. В Windows открыть Switch\Saved games\ - найти там игру Bioshock Remastered с вашим профилем
4. Слить файл `mainSave.bsg` на ПК - он лежит в папке с датой сохранения. Так куча других файлов, но нужен именно этот.

## Использование

1. Сделайте бэкап:

   ```bash
   cp mainSave.bsg mainSave_backup.bsg
   ```
   В Windows - просто сделайте бекап через копирование.

2. Положите обновлённый `bioshock_money.py` рядом с `mainSave.bsg`.

3. Запустите:

   ```bash
   python3 bioshock_money.py mainSave.bsg 5000
   ```
   В Windows используйте `Командная строка` (`cmd`) в папке со скриптом. Также, используйте `python` вместо `python3`, если так настроена ваша система.

4. Скрипт выдаст:

   ```
   Нашёл деньги в блоках: [0]
   Текущие значения денег (по файлу): [23]
   Ставлю новое значение денег: 5000
   Готово, патч сохранён в: mainSave_money_5000.bsg
   ```

5. Полученный файл переименуйте в `mainSave.bsg` и залейте обратно.

6. Запустите игру — у вас будет столько денег, сколько указано.

## Аргументы

```
bioshock_money.py ПУТЬ_К_СЕЙВУ НОВАЯ_СУММА [ВЫХОДНОЙ_ФАЙЛ]
```

## Ограничения и заметки

* Скрипт использует **гибкую сигнатуру** вида:

  ```
  [4 байта денег] 29 00 00 00 00 22 XX 00 00 00
  ```

  Это позволяет работать с более поздними сейвами, где один байт сигнатуры меняется по ходу прохождения.

* Деньги в сейве хранятся как `uint32 LE`, можно задавать большие числа (типа 5000 - 9000).
* Больше 9000 - установить не получится, это похоже глобальное ограничение движка. 
* Игра всё равно будет ограничивать баланс 500$ при подборе денег.
* Скрипт безопасен: если сигнатура не найдена, он **ничего не изменяет**.

## Лицензия

Любая на ваше усмотрение (MIT, BSD, WTFPL и т.п.).
